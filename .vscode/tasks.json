{
  "version": "2.0.0",
  "inputs": [
    {
      "id": "imageName",
      "type": "promptString",
      "description": "Enter the Docker image name:",
      "default": "frog-api:v1"
    }
  ],
  "tasks": [
    {
      "label": "Build Docker Image",
      "detail": "Builds, tags, and saves the Dart Frog Docker image.",
      "dependsOrder": "sequence",
      "dependsOn": [
        "Ask for Image Name",
        "Clean Docker Tar",
        "Build Project",
        "Create Docker Image",
        "Save Docker Tarball"
      ],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "showReuseMessage": false
      }
    },
    {
      "label": "Load Image and Restart Server",
      "detail": "Loads the Docker image and restarts the Dart Frog server.",
      "dependsOrder": "sequence",
      "dependsOn": [
        "Ask for Image Name",
        "Load Docker Image",
        "Stop and Remove Container",
        "Start New Container"
      ],
      "group": {
        "kind": "test"
      },
      "presentation": {
        "reveal": "always",
        "showReuseMessage": false
      }
    },
    {
      "label": "Load Docker Image",
      "hide": true,
      "type": "shell",
      "command": "sudo docker load -i ./frog-api.tar",
      "presentation": {
        "reveal": "silent",
        "echo": false,
        "showReuseMessage": false
      }
    },
    {
      "label": "Stop and Remove Container",
      "hide": true,
      "type": "shell",
      "command": "sudo docker stop frog-app && sudo docker rm frog-app || true",
    },
    {
      "label": "Start New Container",
      "hide": true,
      "type": "shell",
      "command": "sudo docker run -d -p 8080:8080 --name frog-app ${input:imageName}",
    },
    {
      "label": "Ask for Image Name",
      "detail": "Prompts for the Docker image name and confirms it.",
      "hide": true,
      "type": "shell",
      "command": "echo \"Using image: ${input:imageName}\"",
      "presentation": {
        "echo": false,
        "reveal": "always",
        "showReuseMessage": false
      }
    },
    {
      "label": "Clean Docker Tar",
      "detail": "Removes any old Docker tarball without causing an error.",
      "hide": true,
      "type": "shell",
      "command": "rm -f frog-api.tar || true",
      "presentation": {
        "echo": false,
        "reveal": "silent",
        "showReuseMessage": false
      }
    },
    {
      "label": "Build Project",
      "detail": "Cleans, gets dependencies, and bundles the Dart Frog app.",
      "hide": true,
      "type": "shell",
      "command": "flutter clean && flutter pub get && dart_frog build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "showReuseMessage": false
      }
    },
    {
      "label": "Create Docker Image",
      "detail": "Builds the new Docker image based on the generated project.",
      "hide": true,
      "type": "shell",
      "command": "docker build -t ${input:imageName} build/",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "showReuseMessage": false
      }
    },
    {
      "label": "Save Docker Tarball",
      "detail": "Saves the Docker image to a tarball file.",
      "hide": true,
      "type": "shell",
      "command": "docker save -o frog-api.tar ${input:imageName}",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "showReuseMessage": false
      }
    }
  ]
}